<div class="recent-orders">
    <h2>System Analytics</h2>
    <div class="analytics">
        
            <div class="">
                <canvas id="pieChart"></canvas> 
                <script>
                    const ctx = document.getElementById('pieChart').getContext('2d');

                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: [{% for payment in payments %} '{{ payment.date_payed }}', {% endfor %}],
                            datasets: [{
                                label: 'Clients Acquired',
                                data: [{% for payment in payments %} '{{ payment.amount_payed }}', {% endfor %}],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                        }
                    });
                </script>
            </div>
            <div class="">
                <canvas id="cashChart"></canvas>
                <script>
                    const ctl = document.getElementById('cashChart');

                    new Chart(ctl, {
                        type: 'bar',
                        data: {
                            labels: [{% for payment in payments %} '{{ payment.date_payed }}', {% endfor %}],
                            datasets: [{
                                label: 'Amount Received',
                                data: [{% for payment in payments %} '{{ payment.amount_payed }}', {% endfor %}],
                                borderWidth: 1,
                                backgroundColor:[ 
                                'rgba(255, 99, 132, 1)',
                                'rgba(64, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                            ]
                            }]
                        },
                        options: {
                            responsive: true,
                        }
                    });
                </script>
            </div>
    </div>
</div>


<div class="updates">
    <div class="update">
        <div class="profile-photo">
            <img src="{% static 'img/Me2.jpg' %}" alt="mgm">
        </div>
        <div class="message">
            <p><b>Mike</b> Confirmed a pending payment</p>
            <small class="text-muted">4 mins ago</small>
        </div>
    </div>
</div>

<div class="updates">
    <div class="update">
        <div class="profile-photo">
            <img src="{% static 'img/Me2.jpg' %}" alt="mgm">
        </div>
        <div class="message">
            <p><b>Shola</b> Made a payment of #840,000</p>
            <small class="text-muted">7 mins ago</small>
        </div>
    </div>
</div>

<div class="updates">
    <div class="update">
        <div class="profile-photo">
            <img src="{% static 'img/Me2.jpg' %}" alt="mgm">
        </div>
        <div class="message">
            <p><b>Patrick</b> Sent a Notification to all debtors</p>
            <small class="text-muted">10 mins ago</small>
        </div>
    </div>
</div>

<div class="updates">
    <div class="update">
        <div class="profile-photo">
            <img src="{% static 'img/Me2.jpg' %}" alt="mgm">
        </div>
        <div class="message">
            <p><b>Tom</b> Confirmed an order of payment</p>
            <small class="text-muted">17 mins ago</small>
        </div>
    </div>
</div>

        my_payments = Payment.objects.filter(client_id=user_id)[:5]
        my_debtors = Debtor.objects.filter(client_id=user_id).order_by('date_payed').reverse()[:5]
        payments = Payment.objects.filter(client_id=user_id)
        debtors = Debtor.objects.filter(client_id=user_id)
        total = debtors.aggregate(Sum('amount_owed'))['amount_owed__sum']
        retrieved = payments.aggregate(Sum('amount_payed'))['amount_payed__sum']
        debt = total - retrieved
        return render(request, 'clients_dashboard/index.html', {'payments': my_payments, 'debtors': my_debtors, "total": total, "retrieved": retrieved, "debt": debt}) 